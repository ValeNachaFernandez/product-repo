<div class="dashboard-container">
  <h2 class="desktop-titulo">Gestión de Productos</h2>
    <div class="mobile-header">
    <h2>Gestión de Productos</h2>
    <button class="agregar-btn" (click)="abrirModal(modalContenido)" title="Agregar Productos">
      <i class="bi bi-plus-circle"></i>
    </button>
  </div>
  <div class="productos-wrapper">
    <div class="productos-header">
      <div class="header-celda">Nombre</div>
      <div class="header-celda">Precio</div>
      <div class="header-celda">Stock</div>
      <div class="header-celda header-actions">
        <button class="agregar-btn" (click)="abrirModal(modalContenido)" title="Agregar Productos">
          <i class="bi bi-plus-circle"></i>
          <span class="btn-text">Agregar</span>
        </button>
      </div>
    </div>

    <div class="productos-row" *ngFor="let product of productos">
      <div class="celda" data-label="Nombre">{{ product.name }}</div>
      <div class="celda" data-label="Precio">{{ product.price | currency:'CLP':'symbol-narrow':'1.0-0' }}</div>
      <div class="celda" data-label="Stock">{{ product.stock }}</div>
      <div class="celda celda-acciones" data-label="Acciones">
        <button class="borrar-btn" (click)="abrirBorrar(product.id!, modalBorrar)">
          <i class="bi bi-trash3"></i>
          <span class="btn-text">Eliminar</span>
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="productos.length === 0" class="estado-vacio">
    <p>No hay productos disponibles.</p>
  </div>
</div>

<ng-template #modalContenido let-modal>
  <div class="modal-header">
    <h4 class="modal-titulo">
      <i class="bi bi-box-seam"></i>
      <span>Agregar Producto</span>
    </h4>
    <button type="button" class="btn-close btn-close-white" aria-label="Close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body">
    <div class="alert alert-success alert-dismissible fade show" role="alert" *ngIf="mostrarAlerta">
      <i class="bi bi-check-circle-fill me-2"></i>
      <strong>¡Éxito!</strong> Producto agregado correctamente (simulación).
    </div>

    <form #productoForm="ngForm">
      <div class="mb-3">
        <label for="productName" class="form-label">
          <i class="bi bi-tag"></i>
          <span>Nombre del Producto *</span>
        </label>
        <input type="text" class="form-control" id="productName" name="productName" placeholder="Ej: Laptop HP" ngModel
          required #nombreInput="ngModel" [class.is-invalid]="nombreInput.invalid && nombreInput.touched">
        <div class="invalid-feedback" *ngIf="nombreInput.invalid && nombreInput.touched">
          El nombre es obligatorio
        </div>
      </div>

      <div class="mb-3">
        <label for="productPrice" class="form-label">
          <i class="bi bi-currency-dollar"></i>
          <span>Precio (CLP) *</span>
        </label>
        <input type="number" class="form-control" id="productPrice" name="productPrice" placeholder="0" ngModel required
          min="1" #PrecioInput="ngModel" [class.is-invalid]="PrecioInput.invalid && PrecioInput.touched">
        <div class="invalid-feedback" *ngIf="PrecioInput.invalid && PrecioInput.touched">
          <span *ngIf="PrecioInput.errors?.['required']">El precio es obligatorio</span>
          <span *ngIf="PrecioInput.errors?.['min']">El precio debe ser mayor a 0</span>
        </div>
      </div>

      <div class="mb-3">
        <label for="productStock" class="form-label">
          <i class="bi bi-boxes"></i>
          <span>Stock *</span>
        </label>
        <input type="number" class="form-control" id="productStock" name="productStock" placeholder="0" ngModel required
          min="0" #stockInput="ngModel" [class.is-invalid]="stockInput.invalid && stockInput.touched">
        <div class="invalid-feedback" *ngIf="stockInput.invalid && stockInput.touched">
          <span *ngIf="stockInput.errors?.['required']">El stock es obligatorio</span>
          <span *ngIf="stockInput.errors?.['min']">El stock no puede ser negativo</span>
        </div>
      </div>

      <div class="alert alert-info" role="alert">
        <i class="bi bi-info-circle me-2"></i>
        <small><em>Nota: Este formulario es solo visual y no guardará datos reales.</em></small>
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.close()">
      <i class="bi bi-x-circle"></i>
      <span>Cancelar</span>
    </button>
    <button type="button" class="btn btn-primary" (click)="onFalsoSubmit(productoForm, modal)"
      [disabled]="productoForm.invalid">
      <i class="bi bi-save"></i>
      <span>Guardar</span>
    </button>
  </div>
</ng-template>

<ng-template #modalBorrar let-modal>
  <div class="modal-header bg-danger text-white">
    <h5 class="modal-titulo">
      <i class="bi bi-exclamation-triangle"></i>
      <span>Confirmar eliminación</span>
    </h5>
    <button type="button" class="btn-close btn-close-white" aria-label="Close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body text-center">
    <i class="bi bi-exclamation-triangle-fill text-warning" style="font-size: 3rem;"></i>
    <p class="mt-3 mb-0">¿Estás seguro de que deseas eliminar este producto?</p>
    <p class="text-muted"><small>Esta acción no se puede deshacer.</small></p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">
      <i class="bi bi-x-circle"></i>
      <span>Cancelar</span>
    </button>
    <button type="button" class="btn btn-danger" (click)="confirmarBorrar(modal)">
      <i class="bi bi-trash3"></i>
      <span>Eliminar</span>
    </button>
  </div>
</ng-template>